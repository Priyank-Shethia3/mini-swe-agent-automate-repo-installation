"""
Lodash custom test log parser.

Parses test output in the format:
    PASS: 6800  FAIL: 0  TOTAL: 6800
    Finished in 9936 milliseconds.
"""

import re
from enum import Enum


class TestStatus(Enum):
    PASSED = "PASSED"
    FAILED = "FAILED"
    SKIPPED = "SKIPPED"


def parse_log_lodash_custom(log: str) -> dict[str, str]:
    """
    Parser for test logs generated by lodash's custom test runner.

    This parser looks for patterns like:
        PASS: 6800  FAIL: 0  TOTAL: 6800
        Finished in 9936 milliseconds.

    Args:
        log (str): log content
    Returns:
        dict: test case to test status mapping
    """
    test_status_map = {}

    # Pattern for lodash's custom test format
    # Matches: "PASS: 6800  FAIL: 0  TOTAL: 6800"
    pattern = r"PASS:\s*(\d+)\s+FAIL:\s*(\d+)\s+TOTAL:\s*(\d+)"

    test_suite_count = 0

    for line in log.split("\n"):
        match = re.search(pattern, line.strip())
        if match:
            pass_count = int(match.group(1))
            fail_count = int(match.group(2))
            total_count = int(match.group(3))

            test_suite_count += 1

            # Create individual test entries based on counts
            # Since we don't have individual test names, we create generic entries
            suite_name = f"test_suite_{test_suite_count}"

            # Add passed tests
            for i in range(pass_count):
                test_name = f"{suite_name}_test_{i + 1}"
                test_status_map[test_name] = TestStatus.PASSED.value

            # Add failed tests
            for i in range(fail_count):
                test_name = f"{suite_name}_failed_test_{i + 1}"
                test_status_map[test_name] = TestStatus.FAILED.value

    return test_status_map
